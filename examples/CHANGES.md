# 交互式股票预测系统 - 开发总结

## 📅 开发日期
2025年12月3日

## 🎯 项目目标
基于 `prediction_example.py` 和 `prediction_cn_markets_day.py`，创建一个交互式股票预测程序，支持：
1. 用户输入股票代码或上传TXT文件
2. 使用akshare下载最近100个交易日的K线数据
3. 使用Kronos模型预测未来1个月（20个交易日）的走势

## 📦 新增文件

### 1. `stock_prediction_interactive.py` (主程序)
**路径**: `examples/stock_prediction_interactive.py`

**核心功能**:
- ✅ 交互式命令行界面
- ✅ 支持单个股票代码输入
- ✅ 支持从TXT文件批量读取股票代码
- ✅ 使用akshare自动下载K线数据（带重试机制）
- ✅ 数据预处理和清洗（处理缺失值、无效数据）
- ✅ Kronos模型预测（100天历史 → 20天未来）
- ✅ 应用A股涨跌幅限制（±10%）
- ✅ 自动保存CSV结果和PNG图表
- ✅ 详细的进度提示和错误处理

**关键参数**:
```python
LOOKBACK = 100      # 历史数据长度（从400改为100）
PRED_LEN = 20       # 预测长度（从120改为20）
```

### 2. `stock_codes_example.txt` (示例文件)
**路径**: `examples/stock_codes_example.txt`

包含5个常见A股代码：
- 000001 (平安银行)
- 600000 (浦发银行)
- 000002 (万科A)
- 600519 (贵州茅台)
- 002594 (比亚迪)

### 3. `README_stock_prediction.md` (使用文档)
**路径**: `examples/README_stock_prediction.md`

完整的使用说明，包括：
- 快速开始指南
- 两种使用方式的详细说明
- 输出结果说明
- 配置参数介绍
- 故障排除
- 免责声明

## 🔄 相比原有代码的改进

### 对比 `prediction_cn_markets_day.py`

| 特性 | 原版本 | 新版本 |
|------|--------|--------|
| **交互方式** | 命令行参数 | 交互式菜单 |
| **批量处理** | ❌ 不支持 | ✅ 支持TXT文件 |
| **历史数据长度** | 400天 | 100天 |
| **预测长度** | 120天 | 20天（1个月） |
| **用户引导** | 简单 | 详细的菜单和提示 |
| **错误处理** | 基本 | 完善的异常捕获 |
| **可视化** | 单张图表 | 双子图（价格+成交量） |
| **中文支持** | 部分 | 完全中文界面 |

### 核心改进点

1. **用户体验优化**:
   - 添加精美的横幅和菜单
   - 详细的进度提示（emoji图标）
   - 预测完成后的摘要信息

2. **数据处理增强**:
   - 自动调整历史数据长度（如果不足100天）
   - 更完善的数据清洗逻辑
   - 涨跌幅限制应用

3. **批量预测支持**:
   - 从TXT文件读取多个股票代码
   - 自动控制请求频率（每个股票间隔2秒）
   - 统计成功/失败数量

4. **可视化改进**:
   - 同时展示价格和成交量
   - 支持中文字体（SimHei/Microsoft YaHei）
   - 更清晰的图例和标签
   - 高DPI保存（150 DPI）

5. **文件命名优化**:
   - 添加时间戳避免覆盖
   - 格式：`prediction_<股票代码>_<YYYYMMDD_HHMMSS>.csv`

## 📊 技术实现细节

### 数据流程
```
用户输入
  ↓
股票代码列表
  ↓
akshare下载K线数据（最近100+50天）
  ↓
数据清洗和预处理
  ↓
提取最近100个交易日
  ↓
Kronos模型预测（20个交易日）
  ↓
应用涨跌幅限制
  ↓
保存CSV + 绘制图表
  ↓
显示预测摘要
```

### 关键函数

1. **`load_stock_data()`**:
   - 使用akshare获取数据
   - 重试机制（最多3次）
   - 数据清洗和格式转换

2. **`prepare_prediction_inputs()`**:
   - 提取最近100个交易日
   - 生成未来20个工作日时间戳

3. **`apply_price_limits()`**:
   - 应用±10%涨跌幅限制
   - 逐日累计计算

4. **`plot_prediction_result()`**:
   - 双子图可视化
   - 中文支持
   - 高质量输出

5. **`predict_stock()`**:
   - 完整的预测流程
   - 错误处理
   - 结果保存

## 🚀 使用示例

### 示例1: 单个股票
```bash
cd examples
python stock_prediction_interactive.py

# 选择 [1]
# 输入: 000001
```

### 示例2: 批量预测
```bash
cd examples
python stock_prediction_interactive.py

# 选择 [2]
# 输入: stock_codes_example.txt
```

## 📁 输出文件位置
所有预测结果保存在：`examples/stock_predictions/`

## ⚠️ 注意事项

1. **依赖项**:
   - pandas, numpy, akshare, matplotlib, torch
   - Kronos模型文件（NeoQuasar目录）

2. **网络要求**:
   - 需要网络连接以使用akshare

3. **性能建议**:
   - CPU模式：每个股票约1-3分钟
   - GPU模式：可显著加速（将DEVICE改为"cuda:0"）

4. **数据限制**:
   - 仅支持A股股票代码
   - 需要至少100个交易日的历史数据

## 🔮 未来可能的改进

1. ✨ 添加港股、美股支持
2. ✨ 支持选择不同的预测长度
3. ✨ 添加模型性能评估指标
4. ✨ 支持导出Excel格式
5. ✨ 添加Web界面（基于Streamlit或Gradio）
6. ✨ 支持多种可视化风格
7. ✨ 添加实时监控功能

## ✅ 测试建议

运行前请测试：
1. 模型文件是否正确加载
2. akshare能否正常获取数据
3. 输出目录是否可写
4. matplotlib中文字体是否正常显示

---

**开发完成！祝使用愉快！** 🎉
